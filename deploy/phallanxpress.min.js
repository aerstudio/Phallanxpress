((function(){var a,b,c,d,e,f,g=Object.prototype.hasOwnProperty,h=function(a,b){function d(){this.constructor=a}for(var c in b)g.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},i=function(a,b){return function(){return a.apply(b,arguments)}};e=this,d=e.Phallanxpress,typeof exports!="undefined"?c=exports:c=e.Phallanxpress={},c.VERSION="0.1.0",f=e._,!f&&typeof require!="undefined"&&(f=require("underscore")),b=e.Backbone,!b&&typeof require!="undefined"&&(b=require("backbone")),a=e.jQuery||e.Zepto||e.ender,c.noConflict=function(){return e.Phallanxpress=d,this},c.Api=function(){function d(b){var d,e;this.url=b,c.apiURL=this.url,d=document.createElement("a"),d.href=this.url,e='<link rel="dns-prefetch" href="'+d.protocol+"//"+d.hostname+'">',a("head").append(e)}return d.prototype.recentPosts=function(a){var b,d;return a||(a={}),b=new c.Posts,d=this._bindView(b,a.view),b.recentPosts(a),d!=null?d:b},d.prototype.searchPosts=function(a,b){var d,e;return b||(b={}),d=new c.Posts,e=this._bindView(d,b.view),d.searchPosts(a,b),e!=null?e:d},d.prototype.datePosts=function(a,b){var d,e;return b||(b={}),d=new c.Posts,e=this._bindView(d,b.view),d.datePosts(a,b),e!=null?e:d},d.prototype.post=function(a,b){var d,e;b||(b={}),d=new c.Post;if(f.isNumber(a))d.id=a;else{if(!f.isString(a))throw new Error("id must be a number or a string for a slug");d.set({slug:a})}return e=this._bindView(d,b.view),b.postType!=null&&(d.postType=b.postType),d.fetch(b),e!=null?e:d},d.prototype.pageList=function(a){var b,d;return a||(a={}),b=new c.Pages,d=this._bindView(b,a.view),b.pageList(a),d!=null?d:b},d.prototype.page=function(a,b){var d,e;b||(b={}),d=new c.Page;if(f.isNumber(a))d.id=a;else{if(!f.isString(a))throw new Error("id must be a number or a string for a slug");d.set({slug:a})}return e=this._bindView(d,b.view),d.fetch(b),e!=null?e:d},d.prototype.categoryList=function(a){var b,d;return a||(a={}),b=new c.Categories,d=this._bindView(b,a.view),b.categoryList(a),d!=null?d:b},d.prototype.categoryPosts=function(a,b){var d,e;return d=new c.Posts,e=this._bindView(d,b.view),d.categoryPosts(a,b),e!=null?e:d},d.prototype.tagList=function(a){var b,d;return a||(a={}),b=new c.Tags,d=this._bindView(b,a.view),b.tagList(a),d!=null?d:b},d.prototype.tagPosts=function(a,b){var d,e;return d=new c.Posts,e=this._bindView(d,b.view),d.tagPosts(a,b),e!=null?e:d},d.prototype.authorList=function(a){var b,d;return a||(a={}),b=new c.Authors,d=this._bindView(b,a.view),b.authorList(a),d!=null?d:b},d.prototype.authorPosts=function(a,b){var d,e;return d=new c.Posts,e=this._bindView(d,b.view),d.authorPosts(a,b),e!=null?e:d},d.prototype._bindView=function(a,c){var d;if(c!=null){if(c instanceof b.View)d=c,a instanceof b.Collection?(d.obj=a,f.isFunction(d.render)&&(a.on("reset",d.render,d),a.on("add",d.render,d))):(d.model=a,f.isFunction(d.render)&&a.on("change",d.render,d));else{if(!f.isFunction(c))return null;a instanceof b.Collection?d=new c({collection:a}):d=new c({model:a})}return d}return null},d}(),c.Model=function(){function a(){a.__super__.constructor.apply(this,arguments)}return h(a,b.Model),a.prototype.apiCommand="",a.prototype.parseTag="",a.prototype.url=function(){var a;return this.has("slug")?a=""+c.apiURL+apiCommand+"/?slug="+this.get("slug"):this.id!=null&&(a=""+c.apiURL+apiCommand+"/?id="+this.id),this.postType!=null&&(a+="&post_type=#{@post_type}"),this.taxonomy!=null&&(a+="&taxonomy=@{@taxonomy}"),a},a.prototype.parse=function(a,b){return a.status==="ok"?a[this.parseTag]:a},a.prototype.save=function(){},a}(),c.Tag=function(){function a(){a.__super__.constructor.apply(this,arguments)}return h(a,c.Model),a}(),c.Category=function(){function a(){a.__super__.constructor.apply(this,arguments)}return h(a,c.Model),a.prototype.children=function(){return this.collection.filter(i(function(a){return a.get("parent")===this.id},this))},a.prototype.posts=function(a){var b;return b=new c.Posts,b.get_category_posts({id:this.id}),b},a}(),c.Post=function(){function a(){a.__super__.constructor.apply(this,arguments)}return h(a,c.Model),a.prototype.apiCommand="get_post",a.prototype.parseTag="post",a}(),c.Page=function(){function a(){a.__super__.constructor.apply(this,arguments)}return h(a,c.Model),a.prototype.apiCommand="get_page",a.prototype.parseTag="page",a}(),c.Author=function(){function a(){a.__super__.constructor.apply(this,arguments)}return h(a,c.Model),a}(),c.Collection=function(){function d(){d.__super__.constructor.apply(this,arguments)}return h(d,b.Collection),d.prototype.getBySlug=function(a){var b;b=this.filter(function(b){return b.get("slug")===a});switch(b.length){case 1:return b[0];case 0:return null;default:throw new Error("More than one post with the same slug")}},d.prototype._wpAPI=function(b,d){var e,g,h,j;if(b==null)throw new Error("an api command must be defined");return this.isLoading=!0,d=d&&f.clone(d)||{},j=c.apiURL,j+=b+"/",d.params=d.params||{},this.currentCommand=b,e=d.post_type||this.postType,e!=null&&(d.params.post_type=e),this.customFields&&(d.params.custom_fields=this.customFields),h=d.taxonomy||this.taxonomy,h&&(d.params.taxonomy=h),f.isEmpty(d.params)||(j+="?"+a.param(d.params)),this.currentParams=d.params,this.url=j,g=d.success,d.success=i(function(a,b,c){this.isLoading=!1;if(g!=null)return g(this,a)},this),this.options=f.clone(d),delete this.options.success,d.add||this.reset(),this.fetch(d),this},d.prototype.resetVars=function(){return this.page=this.pages=this.count=this.count_total=null},d.prototype.parse=function(a,b){return a.status==="ok"?a[this.parseTag]:(this.trigger("error",a.error,a,b),null)},d.prototype.save=function(){},d}(),c.Categories=function(){function a(){a.__super__.constructor.apply(this,arguments)}return h(a,c.Collection),a.prototype.model=c.Category,a.prototype.parseTag="categories",a.prototype.categoryList=function(a){return this._wpAPI("get_category_index",a)},a.prototype.topCategories=function(){var a;return a=this.filter(function(a){return a.get("parent")===0}),new c.Categories(a)},a}(),c.Pages=function(){function a(){a.__super__.constructor.apply(this,arguments)}return h(a,c.Collection),a.prototype.model=c.Page,a.prototype.parseTag="pages",a.prototype.pageList=function(a){return this._wpAPI("get_page_index",a)},a}(),c.Posts=function(){function a(){a.__super__.constructor.apply(this,arguments)}return h(a,c.Collection),a.prototype.model=c.Post,a.prototype.parseTag="posts",a.prototype.defaultCount=32,a.prototype.recentPosts=function(a){return this._wpAPI("get_recent_posts",this._pageOptions(null,a))},a.prototype.categoryPosts=function(a,b){return this._wpAPI("get_category_posts",this._pageOptions(a,b))},a.prototype.authorPosts=function(a,b){return this._wpAPI("get_author_posts",this._pageOptions(a,b))},a.prototype.tagPosts=function(a,b){return this._wpAPI("get_tag_posts",this._pageOptions(a,b))},a.prototype.searchPosts=function(a,b){return b=this._pageOptions(null,b),b.params.search=a,this._wpAPI("get_search_results",b)},a.prototype.datePosts=function(a,b){return b=this._pageOptions(null,b),b.params.date=a,this._wpAPI("get_date_posts",b)},a.prototype.pageUp=function(a){return this.toPage(this.page+1,a)},a.prototype.pageDown=function(a){return this.toPage(this.page-1,a)},a.prototype.toPage=function(a,b){return b=b&&f.clone(b)||{},this.options!=null&&(b=f.defaults(b,this.options)),a!=null&&a>=1&&a<=this.pages?(b.page=a,this._wpAPI(this.currentCommand,this._pageOptions(this.apiObject,b))):!1},a.prototype._pageOptions=function(a,b){return b=b&&f.clone(b)||{},b.params=b.params||{},a!=null&&(this.apiObject=a,f.isNumber(a)?b.params.id=a:f.isString(a)?b.params.slug=a:a.id!=null&&(b.params.id=a.id)),b.params.count=b.count||this.defaultCount,this.page=b.page||1,b.params.page=this.page,b},a.prototype.parse=function(a,b){return a.status==="ok"?(this.count_total=a.count_total,this.pages=a.pages,this.count=a.count,this.count_total===0?(this.trigger("no posts",a,b),null):a.posts):(this.trigger("error",a.error,a,b),null)},a}(),c.Tags=function(){function a(){a.__super__.constructor.apply(this,arguments)}return h(a,c.Collection),a.prototype.model=c.Tag,a.prototype.parseTag="tags",a.prototype.tagList=function(a){return this._wpAPI("get_tag_index",a)},a}(),c.Authors=function(){function a(){a.__super__.constructor.apply(this,arguments)}return h(a,c.Collection),a.prototype.model=c.Author,a.prototype.parseTag="authors",a.prototype.authorList=function(a){return this._wpAPI("get_author_index",a)},a}()})).call(this)