var Phallanxpress,namespace,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},__bind=function(a,b){return function(){return a.apply(b,arguments)}};namespace=function(a){var b,c,d,e,f,g,h;c=self,f=a.split("."),h=[];for(d=0,e=f.length;d<e;d++)b=f[d],h.push(c=(g=c[b])!=null?g:c[b]={});return h},namespace("PP"),namespace("PP.Models"),namespace("PP.Collections"),Phallanxpress=function(){function a(a){var b,c;this.url=a,PP.Host=this.url,b=document.createElement("a"),b.href=this.url,c='<link rel="dns-prefetch" href="'+b.protocol+"//"+b.hostname+'">',$("head").append(c)}return a}(),PP.Model=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,Backbone.Model),a.prototype.apiCommand="",a.prototype.parseTag="",a.prototype.url=function(){var a;return this.has("slug")?a=""+PP.Host+apiCommand+"/?slug="+this.get("slug"):this.id!=null&&(a=""+PP.Host+apiCommand+"/?id="+this.id),a},a.prototype.parse=function(a,b){return a.status==="ok"?a[this.parseTag]:a},a}(),PP.Models.Tag=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,PP.Model),a}(),PP.Models.Category=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,PP.Model),a.prototype.children=function(){return this.collection.filter(__bind(function(a){return a.get("parent")===this.id},this))},a.prototype.posts=function(a){var b;return b=new PP.Collections.Posts,b.get_category_posts({id:this.id}),b},a}(),PP.Models.Post=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,PP.Model),a.prototype.apiCommand="get_post",a.prototype.parseTag="post",a}(),PP.Models.Page=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,PP.Model),a.prototype.apiCommand="get_page",a.prototype.parseTag="page",a}(),PP.Collection=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,Backbone.Collection),a.prototype.postType="post",a.prototype.getBySlug=function(a){var b;b=this.filter(function(b){return b.get("slug")===a});switch(b.length){case 1:return b[0];case 0:return null;default:throw new Error("More than one post with the same slug")}},a.prototype._wpAPI=function(a,b){var c,d,e;if(a==null)throw new Error("an api command must be defined");return this.isLoading=!0,b=b&&_.clone(b)||{},e=PP.Host,e+=a+"/",b.params=b.params||{},this.currentCommand=a,c="?post_type="+this.postType,_.isEmpty(b.params)||(c+="&"+$.param(b.params)),e+=c,this.customFields!=null&&(e+="&"+$.param(this.customFields)),this.taxonomy!=null&&(e+="&taxonomy="+this.taxonomy),this.currentParams=b.params,this.url=e,log("[WP API] cmd: "+a+", options: ",b),log("[WP API] url: "+e),d=b.success,b.success=__bind(function(a,b,c){this.isLoading=!1;if(d!=null)return d(this,a)},this),this.options=_.clone(b),delete this.options.success,b.add||this.reset(),this.fetch(b),this},a.prototype.resetVars=function(){return this.page=this.pages=this.count=this.count_total=null},a.prototype.parse=function(a,b){return a.status==="ok"?a[this.parseTag]:(this.trigger("error",a.error,a,b),null)},a}(),PP.Collections.Categories=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,PP.Collection),a.prototype.model=PP.Models.Category,a.prototype.parseTag="categories",a.prototype.get_category_index=function(a){return this._wpAPI("get_category_index",a)},a.prototype.topCategories=function(){var a;return a=this.filter(function(a){return a.get("parent")===0}),new PP.Collections.Categories(a)},a}(),PP.Collections.Pages=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,PP.Collection),a.prototype.model=PP.Models.Page,a.prototype.parseTag="pages",a.prototype.postType="page",a.prototype.get_page_index=function(a){return this._wpAPI("get_page_index",a)},a}(),PP.Collections.Posts=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,PP.Collection),a.prototype.model=PP.Models.Post,a.prototype.parseTag="posts",a.prototype.defaultCount=32,a.prototype.get_recent_posts=function(a){return this._wpAPI("get_recent_posts",this._pageOptions(null,a))},a.prototype.get_category_posts=function(a,b){return this._wpAPI("get_category_posts",this._pageOptions(a,b))},a.prototype.get_author_posts=function(a,b){return this._wpAPI("get_author_posts",this._pageOptions(a,b))},a.prototype.get_tag_posts=function(a,b){return this._wpAPI("get_tag_posts",this._pageOptions(a,b))},a.prototype.get_search_results=function(a,b){return b=this._pageOptions(null,b),b.params.search=a,this._wpAPI("get_search_results",b)},a.prototype.get_date_posts=function(a,b){return b=this._pageOptions(null,b),b.params.date=a,this._wpAPI("get_date_posts",b)},a.prototype.pageUp=function(a){return a=a&&_.clone(a)||{},this.options!=null&&(a=_.defaults(a,this.options)),this.page+1<=this.pages?(a.page=this.page+1,this._wpAPI(this.currentCommand,this._pageOptions(this.apiObject,a))):!1},a.prototype.pageDown=function(a){return a=a&&_.clone(a)||{},this.options!=null&&(a=_.defaults(a,this.options)),this.page-1>=1?(a.page=this.page-1,this._wpAPI(this.currentCommand,this._pageOptions(this.apiObject,a))):!1},a.prototype._pageOptions=function(a,b){return b=b&&_.clone(b)||{},b.params=b.params||{},a!=null&&(this.apiObject=a,_.isNumber(a)?b.params.id=a:_.isString(a)?b.params.slug=a:a.id!=null&&(b.params.id=a.id)),b.params.count=b.count||this.defaultCount,this.page=b.page||1,b.params.page=this.page,b},a.prototype.parse=function(a,b){return a.status==="ok"?(this.count_total=a.count_total,this.pages=a.pages,this.count=a.count,this.count_total===0?(this.trigger("no posts",a,b),null):a.posts):(this.trigger("error",a.error,a,b),null)},a}(),PP.Collections.Tags=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,PP.Collection),a.prototype.model=PP.Models.Tag,a.prototype.parseTag="tags",a.prototype.get_tag_index=function(a){return this._wpAPI("get_tag_index",a)},a}()